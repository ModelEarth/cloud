<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Run Models</title>
  <!-- provides getHash() -->
  <link type="text/css" rel="stylesheet" href="https://model.earth/localsite/css/base.css" id="/localsite/css/base.css">
  <link type="text/css" rel="stylesheet" href="/cloud/run/css/param.css">
  <script type="text/javascript" src="https://model.earth/localsite/js/localsite.js?showheader=true&showsearch=true"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
  <script src="js/param-input.js"></script>

  <style>
    bodyXX {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding: 20px;
    }
    /*
    .container {
      text-align: center;
      margin-top: 50px;
    }
    */
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 32px;
      font-size: 16px;
      margin: 8px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    .config-link {
      background-color: #007bff;
      color: white !important;
      padding: 13px 24px;
      text-decoration: none;
      border-radius: 4px;
      font-size: 16px;
      margin: 4px 2px;
      display: inline-block;
    }
    .config-link:hover {
      background-color: #0056b3;
    }
    #status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 14px;
      margin-top: 20px;
      color: #333;
    }
    textarea::placeholder {
      color: #bbb;
      font-style: italic;
      font-size: 13px;
      opacity: 1;
    }
    #params {
      margin-top: 30px;
      text-align: left;
      background: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .button-container {
      text-align: center;
      margin-top: 20px;
    }
    #stepsContainer {
    display: none;
    margin-top: 20px;
    padding: 10px;
    border-radius: 5px;
    }
    #stepsContainer label {
    display: block;
    margin: 4px 0;
    }
    #logoutButton {
      float: right;
      margin-top: -42px; /* Aligns with the h1 */
      background-color: #f44336;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    #logoutButton:hover {
      background-color: #d32f2f;
    }
    #stepsLoading {
      display: none;
      font-size: 14px;
      margin-top: 8px;
      color: #555;
      font-style: italic;
    }

    /* ===== Flask Status Banner (matches data-pipeline admin) ===== */
#serverStatusBanner {
  display: none;
  width: 100%;
  box-sizing: border-box;
  padding: 14px 18px;
  margin-bottom: 16px;

  background: #3b261d; /* dark brown */
  color: #ffcc9c;

  border-bottom: 1px solid #5a3a2a;
  border-radius: 6px;

  font-size: 16px;
  font-weight: 500;

  display: flex;
 align-items: flex-start;

  justify-content: space-between;
  gap: 16px;
}

#serverStatusLeft {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  min-width: 0;
  align-self: flex-start; 
}

#serverStatusIcon {
  font-size: 18px;
}

#serverStatusText {
  white-space: normal;    
  overflow-wrap: anywhere;
  flex: 1;                
  min-width: 0;           
}

/* Buttons */
#serverStatusActions {
  display: flex;
  gap: 10px;
  align-items: center;
}

#retryServerCheck {
  font-size: 0.875rem;                      
  padding: 0.25rem 0.75rem;                 
  background: rgba(249, 115, 22, 0.30);     
  border: 1px solid rgba(249, 115, 22, 0.50);  
  border-radius: 0.375rem;                 
  color: #fed7aa;                           
  cursor: pointer;

  
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  height: 34px;                             
  box-sizing: border-box;
   margin: 0 !important;    
}

#retryServerCheck:hover {
   background: rgba(249, 115, 22, 0.50);  
}

#activateFlaskLink {
  font-size: 0.875rem;                   
  padding: 0.15rem 0.75rem;              
  background: rgba(59, 130, 246, 0.30);  
  border: 1px solid rgba(59, 130, 246, 0.50);  
  border-radius: 0.375rem;               
  color: #bfdbfe !important;             
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;

  height: 34px;                          
  box-sizing: border-box;
  margin: 0 !important;
}

#activateFlaskLink:hover {
  background: rgba(59, 130, 246, 0.50);  
}

  </style>
</head>
<body data-param-input="cloud-run">
  <div class="content contentpadding">

    <!-- Flask status banner -->
<div id="serverStatusBanner">
  <div id="serverStatusLeft">
    <span id="serverStatusIcon">⚠️</span>
    <span id="serverStatusText">Flask Server is not running</span>
  </div>

  <div id="serverStatusActions">
    <button id="retryServerCheck">Retry Check</button>
    <a id="activateFlaskLink"
       href="http://localhost:8887/data-pipeline/flask/"
       target="_blank"
       rel="noreferrer">
      Activate Flask Server
    </a>
  </div>
</div>




<div id="tokenPanel" style="
  margin-bottom:14px;
  padding:12px 14px;
  border:1px solid rgba(0,0,0,0.12);
  border-radius:10px;
  max-width:720px;
">
  <div style="font-size:16px; font-weight:600; margin-bottom:8px;">
    UI Access Token
  </div>

<div style="
  display: flex;
  gap: 10px;
  align-items: center;
">
  <input
    id="tokenInput"
    type="password"
    placeholder="Paste UI_ACCESS_TOKEN here"
    style="
      flex: 1;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.2);
    "
  />

  <button id="saveTokenBtn" style="padding:8px 14px;">
    Save Token
  </button>

  <span id="tokenSavedMsg"
        style="color:green; display:none;">
    Saved ✅
  </span>
</div>


   
</div>

    <h1 style="position: relative;">
      Run Models
      <button id="logoutButton" onclick="logout()">Logout</button>
    </h1>


<!--
For comparison of textarea instead of div + pre below.<br>
<textarea id="yamlInput" placeholder="">folder: naics6-bees-counties
features:
  data: industries
  common: Fips
  path: https://raw.githubusercontent.com/ModelEarth/community-timelines/main/training/naics6/US/counties/2020/US-ME-training-naics6-counties-2020.csv
targets:
  data: bees
  path: https://raw.githubusercontent.com/ModelEarth/bee-data/main/targets/bees-targets-top-20-percent.csv
models: xgboost</textarea>
<br>
<br>
-->

<select id="parambase"></select>

<div id="pathControls"></div>

<div id="paramText" class="codetext" rows="10" contenteditable><pre>
<b>folder:</b> naics6-bees-counties

<b>features:</b>
  data: industries
  common: Fips
  path: https://raw.githubusercontent.com/ModelEarth/community-timelines/main/training/naics6/US/counties/2020/US-ME-training-naics6-counties-2020.csv

<b>targets:</b>
  data: bees
  path: https://raw.githubusercontent.com/ModelEarth/bee-data/main/targets/bees-targets-top-20-percent.csv

<b>models:</b> xgboost
</pre></div>

<br><br>
    <label>
      <input type="checkbox" id="enableSteps">
      Select steps to run
    </label>
    <div id="stepsContainer"></div>
    <div id="stepsLoading">Loading available steps…</div>
    <div class="button-container">
      <button id="runButton">Run Notebook</button>
      <a href="/config" class="config-link">Flask Server Config</a>
    </div>

    <div id="status" style="display: none;"></div>
    <div id="pageparams" style="display: none;"></div>
  </div>


</body>
</html>
